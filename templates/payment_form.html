{% extends 'base.html' %}

{% block title %}{{ _('payments.edit_title') if _('payments.edit_title') else 'Edit Payment' }}{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
  <h1 class="text-lg font-semibold mb-4">{{ _('payments.edit_title') }} - {{ member.name }} {{ member.surname }}</h1>

  <form method="post" action="{{ action }}" class="bg-white border rounded p-4 space-y-3">
    <div>
      <label class="block text-sm">{{ _('payments.month') }}</label>
      <select name="period_month" class="mt-1 w-full border rounded px-2 py-1">
        {% for m in range(1,13) %}
          {% if payment.period_month == m %}
            <option value="{{ m }}" selected>{{ m }}</option>
          {% else %}
            <option value="{{ m }}">{{ m }}</option>
          {% endif %}
        {% endfor %}
      </select>
    </div>

    <div>
      <label class="block text-sm">{{ _('payments.year') }}</label>
      <input name="period_year" type="number" value="{{ payment.period_year }}" class="mt-1 w-full border rounded px-2 py-1" />
    </div>

    <div class="sm:col-span-2 col-span-6">
      <label class="block text-sm">{{ _('payments.price') }}</label>
      <div class="mt-1">
        <select name="price_id" id="price_select_edit" class="w-full border rounded px-2 py-1">
          <option value="">--</option>
          {% for p in prices %}
            {% if payment.price_id and payment.price_id == p.id %}
              <option value="{{ p.id }}" data-amount="{{ p.amount }}" selected>{{ p.description }} ({{ p.amount }})</option>
            {% else %}
              <option value="{{ p.id }}" data-amount="{{ p.amount }}">{{ p.description }} ({{ p.amount }})</option>
            {% endif %}
          {% endfor %}
        </select>
      </div>
    </div>

    <div class="sm:col-span-1 col-span-6">
      <label class="block text-sm">&nbsp;</label>
      <div class="mt-1">
        <!-- match other inputs exactly for consistent height -->
        <input type="text" id="price_amount_display_edit" aria-label="Selected price amount" disabled class="w-full mt-1 border rounded px-2 py-1 bg-gray-50 text-right" placeholder="0.00" />
      </div>
    </div>

    <div class="sm:col-start-1">
      <label class="block text-sm">{{ _('payments.notes') }}</label>
      <input name="notes" value="{{ payment.notes or '' }}" class="mt-1 w-full border rounded px-2 py-1" />
    </div>

    <div class="flex items-center space-x-2 pt-2">
      <button class="px-3 py-2 bg-blue-600 text-white rounded">{{ _('payments.save') }}</button>
      <a href="/members/{{ member.id }}/payments" class="px-3 py-2 border rounded">{{ _('payments.cancel') }}</a>
    </div>
  </form>
</div>
{% endblock %}

{% block scripts %}{{ super() }}
<script>
  (function(){
    function showAmount(sel, dispId){
      var disp = document.getElementById(dispId);
      if(!disp || !sel) return;
      var val = sel.value;
      if(!val){ disp.value = ''; return; }
      var opt = sel.querySelector('option[value="'+val+'"]');
      var amt = opt ? opt.dataset.amount : '';
      if(amt !== undefined && amt !== ''){
        try{ disp.value = parseFloat(amt).toFixed(2); }catch(e){ disp.value = amt; }
      } else {
        disp.value = '';
      }
    }
    document.addEventListener('DOMContentLoaded', function(){
      var sel = document.getElementById('price_select_edit');
      if(!sel) return;
      sel.addEventListener('change', function(){ showAmount(sel, 'price_amount_display_edit'); });
      showAmount(sel, 'price_amount_display_edit');
    });
  })();
</script>
{% endblock %}
